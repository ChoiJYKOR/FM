# FM 퓨즈 검수 AI 강의 시리즈 | 2부
## "YOLO: 초고속 물체 감지의 비밀"

---

## 📚 **강의 목표**

**이 2부를 끝내면 당신도 알 수 있어요:**
- "CNN은 느린데, YOLO는 왜 초고속일까?"
- "물체가 어디에 있는지 어떻게 찾지?"
- "ROI(관심 영역)란 뭐고, 왜 중요한가?"
- "FM이 초당 30개 검사하는 비결이 뭔가?"

---

# **섹션 1: CNN의 한계, YOLO의 탄생**

## ⚡ **문제: CNN은 느리다**

### **상황: FM의 생산 라인**

```
생산 속도: 초당 3개 퓨즈 통과
필요 검사 속도: 초당 최소 5개 (여유)

CNN 검사 속도:
├─ 이미지 캡처: 33ms (30fps)
├─ CNN 처리: 200ms
├─ 결과 출력: 10ms
└─ 합계: 243ms (초당 4개만 가능)

결과: 퓨즈가 검사를 받기 전에 지나감! ❌
```

### **CNN의 구조적 문제**

```
CNN (Traditional Approach)

입력 이미지 (640x640)
        ↓
[합성곱층] × 20번 → 시간 오래 걸림
        ↓
[풀링층]
        ↓
[완전 연결층] → 모든 픽셀 처리 필요
        ↓
결과: "정상" or "불량"

문제 1: "불량이 어디 있어?"라는 질문에 답 못함
문제 2: 이미지 전체를 다 처리해야 함
문제 3: 느림 (200ms+)
```

---

## 🎯 **해결책: YOLO (You Only Look Once)**

> **"한 번만 보면 돼!" - 초고속 물체 감지의 혁신**

### **YOLO의 핵심 아이디어**

```
기존 CNN:
"이 이미지가 뭔지 분류하기" → "정상/불량"

YOLO:
"이 이미지에서 뭐가 어디 있는지 찾기" 
→ "(불량) 이미지 위의 (x=200, y=150) 위치"
```

### **YOLO vs CNN: 속도 비교**

```
┌──────────────────┬──────────┬──────────┐
│                  │   CNN    │  YOLO    │
├──────────────────┼──────────┼──────────┤
│ 처리 시간        │ 200ms    │ 30ms     │
│ 초당 검사량      │ 4개      │ 30개     │
│ 위치 정보        │ 없음     │ 있음     │
│ 속도 향상도      │ 기준     │ 6.7배 ⚡ │
└──────────────────┴──────────┴──────────┘
```

---

# **섹션 2: YOLO의 작동 원리**

## 🔍 **"YOLO는 어떻게 한 번에 모든 걸 본다?"**

### **Step 1: 이미지를 그리드로 나누기**

```
FM 카메라 이미지 (640 x 640)
        ↓
YOLO이 상상하는 그리드:

┌─────┬─────┬─────┬─────┐
│ (1) │ (2) │ (3) │ (4) │
├─────┼─────┼─────┼─────┤
│ (5) │ (6) │ (7) │ (8) │  ← 4 x 4 = 16개 셀
├─────┼─────┼─────┼─────┤
│ (9) │(10) │(11) │(12) │
├─────┼─────┼─────┼─────┤
│(13) │(14) │(15) │(16) │
└─────┴─────┴─────┴─────┘

각 셀: 160 x 160 픽셀
YOLO가 "각 셀에 뭐가 있나?"를 빠르게 체크!
```

### **FM 퓨즈 검사에 적용**

```
이미지: 640 x 640 (퓨즈 1개)

YOLO 그리드: 4 x 4 = 16개 셀

┌─────────────────────────┬────────────────────────┐
│ 셀 (1,1)                │ 셀 (1,2)               │
│ "왼쪽 끝이 있네?"       │ "뭔가 있지만 작음"     │
├─────────────────────────┼────────────────────────┤
│ 셀 (2,1)                │ 셀 (2,2)               │
│ "중앙이야. 와이어?"     │ "중앙. 가장 중요!"     │
├─────────────────────────┼────────────────────────┤
│ 셀 (3,1)                │ 셀 (3,2)               │
│ "오른쪽. 캡?"           │ "정상이네?"            │
├─────────────────────────┼────────────────────────┤
│ 셀 (4,1)                │ 셀 (4,2)               │
│ "끝. 별 거 없음"        │ "경계"                 │
└─────────────────────────┴────────────────────────┘
```

---

# **섹션 3: ROI (Region of Interest) - 관심 영역**

## 🎯 **"어디가 중요한가?"**

> **YOLO의 진짜 강력함: 불량이 "어디에" 있는지 알아낸다**

### **ROI란?**

```
ROI = Region of Interest (관심 영역)
= "AI가 '이 부분이 중요하다'고 생각하는 영역"
```

### **FM 퓨즈에서의 ROI**

```
퓨즈 전체 이미지

┌──────────────────────────────────┐
│  왼쪽 캡     │  중앙 와이어   │  오른쪽 캡   │
│ (덜 중요)    │  (가장 중요!)  │ (덜 중요)    │
└──────────────────────────────────┘

AI의 시선:
①번 카메라: "중앙 와이어 부분이 가장 중요해!" 
           → 그 부분만 집중 검사

결과:
├─ 와이어 손상: 99.8% 정확도 ✅
├─ 색상 이상: 95% 정확도
└─ 캡 손상: 92% 정확도
```

---

## 🔲 **YOLO가 하는 일: Bounding Box (경계 상자)**

```
불량 퓨즈를 발견했을 때:

┌──────────────────────────────────┐
│                                  │
│   ┌───────────────────┐          │
│   │  불량 영역!      │          │
│   │  와이어 손상      │          │
│   │  신뢰도: 98.7%   │          │
│   └───────────────────┘          │
│                                  │
└──────────────────────────────────┘

YOLO가 출력하는 정보:
├─ 위치: x=250, y=180 (픽셀 좌표)
├─ 크기: 너비=150px, 높이=80px
├─ 분류: "와이어 손상"
└─ 신뢰도: 98.7%
```

---

# **섹션 4: YOLO의 구조 (YOLOv11 기준)**

## 🏗️ **"YOLO의 내부 구조"**

```
YOLO11 = CNN의 진화판

입력 이미지 (640x640)
        ↓
┌─────────────────────────────┐
│  Backbone (척추)             │
│  ┌─────────────────────────┐ │
│  │ 합성곱층 × 10개         │ │  ← CNN처럼 패턴 찾기
│  │ (하지만 더 효율적!)     │ │
│  └─────────────────────────┘ │
└─────────────────────────────┘
        ↓
┌─────────────────────────────┐
│  Neck (목)                   │
│  ┌─────────────────────────┐ │
│  │ 다양한 크기의 특징 결합  │ │  ← 작은 결함도 감지
│  │ (마이크로 스케일)      │ │
│  └─────────────────────────┘ │
└─────────────────────────────┘
        ↓
┌─────────────────────────────┐
│  Head (머리)                 │
│  ┌─────────────────────────┐ │
│  │ 최종 판단               │ │  ← ROI 생성
│  │ Bounding Box + 신뢰도  │ │
│  └─────────────────────────┘ │
└─────────────────────────────┘
        ↓
결과: 
├─ 위치: (x, y, width, height)
├─ 클래스: "정상", "와이어손상", "캡손상" 등
└─ 신뢰도: 0.0 ~ 1.0 (0% ~ 100%)
```

### **각 부분의 역할**

```
1️⃣ Backbone (특징 추출)
   역할: CNN처럼 이미지의 특징을 찾기
   입력: 640x640 이미지
   출력: 다양한 크기의 특징맵
   시간: 20ms

2️⃣ Neck (특징 통합)
   역할: 작은 것부터 큰 것까지 모든 크기를 통합
   입력: 여러 크기의 특징맵
   출력: 균형잡힌 특징
   시간: 5ms
   
   FM 퓨즈에서:
   ├─ 큰 스크래치: 감지
   ├─ 미세한 결함: 감지 ⚡
   └─ 마킹 오류: 감지

3️⃣ Head (최종 판단)
   역할: ROI 생성 및 신뢰도 계산
   입력: 통합된 특징
   출력: Bounding Box + 분류 + 신뢰도
   시간: 5ms
```

---

# **섹션 5: FM 퓨즈 검사에서의 YOLO 실행**

## 🎬 **실시간 검사 과정 (0.03초 단위)**

```
Frame #1 (0ms)
입력: 카메라 이미지 (640x640)
       ↓
YOLO 처리 (30ms)
├─ Backbone: 이미지의 특징 찾기 (20ms)
├─ Neck: 특징 통합 (5ms)  
└─ Head: ROI 생성 (5ms)
       ↓
출력 (0ms): 
"정상" (신뢰도: 99.2%)
┌──────────────────────────────┐
│ ✅ 합격!                      │
└──────────────────────────────┘

Frame #2 (33ms)
입력: 다음 퓨즈
       ↓
... (같은 과정)
       ↓
출력: 
"와이어 손상" (신뢰도: 98.7%)
       위치: x=250, y=180
┌──────────────────────────────┐
│ ❌ 불량!                     │
│ → 분류기 (Classifier)로 이동  │
└──────────────────────────────┘

Frame #3 (66ms)
...

초당 30프레임 × 1퓨즈 = 초당 30개 검사! ✅
```

---

## 📊 **실제 YOLO 출력 예시**

```
입력 이미지: 4pin_fuse_001.jpg (정상)
        ↓
YOLO 처리
        ↓
출력 JSON:
{
  "predictions": [
    {
      "class": "normal_fuse",
      "confidence": 0.992,
      "bbox": {
        "x": 320,
        "y": 320,
        "width": 600,
        "height": 200
      },
      "processing_time": 32.5  // ms
    }
  ]
}

결과: "정상" (99.2% 확신)
위치: 이미지 중앙 (x=320, y=320)
크기: 600 x 200픽셀
처리 시간: 32.5ms


---

입력 이미지: 4pin_fuse_042.jpg (불량)
        ↓
YOLO 처리
        ↓
출력 JSON:
{
  "predictions": [
    {
      "class": "wire_damage",
      "confidence": 0.987,
      "bbox": {
        "x": 250,
        "y": 180,
        "width": 150,
        "height": 80
      },
      "processing_time": 31.8  // ms
    }
  ],
  "action": "REJECT"  // ❌ 불량 처리
}

결과: "와이어 손상" (98.7% 확신)
위치: (x=250, y=180) - 퓨즈 상단 중앙
크기: 150 x 80픽셀 (손상 영역)
처리 시간: 31.8ms
```

---

# **섹션 6: 다중 클래스 분류 (Multi-Class Detection)**

## 🏷️ **"FM 퓨즈의 5가지 불량을 동시에 감지"**

### **YOLO가 배운 5가지 결함**

```
클래스 1: normal_fuse (정상)
  신뢰도 기준: ≥ 95%

클래스 2: wire_damage (와이어 손상)
  특징: 중앙의 검은 선이 끊김
  감지 위치: 중앙 (x=280~360, y=160~240)

클래스 3: cap_damage (캡 손상)
  특징: 양쪽 끝이 불규칙
  감지 위치: 양 끝 (x=40~80 또는 x=560~600)

클래스 4: surface_scratch (표면 스크래치)
  특징: 미세한 선 패턴
  감지 위치: 전체 (하지만 특히 표면)

클래스 5: marking_error (마킹 오류)
  특징: 글자가 겹치거나 흐림
  감지 위치: 상단/하단 레이블

클래스 6: color_abnormal (색상 이상)
  특징: RGB값 이상
  감지: 색상 채널 분석
```

### **한 이미지에 여러 결함이 있을 때?**

```
입력 이미지: 4pin_fuse_broken.jpg

YOLO 출력:
{
  "predictions": [
    {
      "class": "wire_damage",
      "confidence": 0.95,
      "bbox": {"x": 300, "y": 180, "width": 100, "height": 80}
    },
    {
      "class": "surface_scratch",
      "confidence": 0.87,
      "bbox": {"x": 150, "y": 250, "width": 200, "height": 60}
    },
    {
      "class": "cap_damage",
      "confidence": 0.92,
      "bbox": {"x": 580, "y": 320, "width": 50, "height": 80}
    }
  ],
  "action": "REJECT_MULTIPLE"  // 3개 결함 감지!
}

결과:
├─ 와이어 손상 (95% 신뢰도) ← 가장 심각
├─ 캡 손상 (92% 신뢰도)
└─ 표면 스크래치 (87% 신뢰도)

최종 판단: ❌ 불량 (3개 결함)
```

---

# **섹션 7: Anchor Box (앵커 박스)**

## 📐 **"YOLO가 ROI를 찾는 비결"**

```
문제: YOLO가 어떤 크기의 물체를 찾아야 할까?

해결: Anchor Box (미리 정의된 상자 모양)

FM 퓨즈용 Anchor Box:
┌─────────────────────────────┐
│ Anchor 1: 작은 결함 감지    │
│ 크기: 30 x 30 (미세 스크래치) │
│                             │
│ Anchor 2: 중간 크기          │
│ 크기: 100 x 100 (캡 손상)    │
│                             │
│ Anchor 3: 큰 결함            │
│ 크기: 200 x 150 (와이어 손상) │
└─────────────────────────────┘

YOLO의 사고 과정:
"이 영역... Anchor 2와 비슷하네? 
 = 캡 손상일 확률 높음!"
```

---

# **섹션 8: Non-Maximum Suppression (NMS)**

## 🧹 **"겹치는 감지 박스 정리"**

### **문제: 같은 결함을 여러 번 감지할 수 있다**

```
와이어 손상 영역에 YOLO가 여러 박스를 그렸을 때:

┌─────────────────────────────┐
│                             │
│   ┌──────────────┐          │
│   │ wire_damage  │ 신뢰: 98%│
│   │ (x=250)      │          │
│   │  ┌─────────┐ │          │
│   │  │damage   │ │ 신뢰: 87%│ ← 겹친다!
│   │  │(x=260)  │ │          │
│   │  └─────────┘ │          │
│   └──────────────┘          │
│                             │
└─────────────────────────────┘

NMS 적용 전: 2개 감지 (혼란스럼)
NMS 적용 후: 1개 감지 (신뢰도 98% 선택) ✅
```

---

# **섹션 9: Confidence Threshold (신뢰도 임계값)**

## 📊 **"AI의 확신이 낮으면 버린다"**

```
FM 퓨즈 검사의 신뢰도 기준:

신뢰도 95% 이상: ✅ 합격 (확실)
신뢰도 85-95%: ⚠️ 재검사 (의심)
신뢰도 85% 미만: ❌ 불량 (불확실)

실제 YOLO 출력:

예시 1: 확실한 정상
"normal_fuse" - 신뢰도 99.5% → ✅ 통과

예시 2: 확실한 불량
"wire_damage" - 신뢰도 98.1% → ❌ 불량 처리

예시 3: 의심스러운 결과
"surface_scratch" - 신뢰도 72% → ⚠️ 재검사
(AI가 확신 못하면, 최종 검증팀이 봄)

FM의 99.5% 신뢰도 달성:
├─ YOLO: 99.2% (초고속)
├─ 재검사: 0.2% (의심 케이스)
├─ 최종 검증: 0.1% (인간 검사)
└─ 합계: 99.5% ✅
```

---

# **섹션 10: YOLO의 학습 과정 (2부 심화)**

## 📚 **"YOLO를 FM 퓨즈에 맞게 훈련하기"**

### **Step 1: 데이터 준비**

```
8,000개 원본 이미지
├─ 정상: 5,000장
├─ 와이어 손상: 1,200장
├─ 색상 불량: 800장
└─ 기타: 1,000장

각 이미지에 "라벨" 붙이기:
예시) 4pin_fuse_042.jpg
├─ 와이어 손상: x=250, y=180, w=150, h=80
├─ 신뢰도 레벨: High
└─ 확인자: QA 검사원
```

### **Step 2: 데이터 증강**

```
8,000장 × 5배 증강 = 40,000장

회전 (-5° ~ +5°)
밝기 조정 (-10% ~ +10%)
좌우 반전
작은 이동
줌인 (+5% ~ +15%)
```

### **Step 3: YOLO 훈련**

```
YOLOv11n (Nano - 가볍고 빠름) 선택

훈련 설정:
├─ Epochs: 100
├─ Batch size: 16
├─ Learning rate: 0.01
├─ Device: GPU (RTX 4090)
└─ 예상 시간: 1~2시간

훈련 진행:
Epoch 1:    mAP50: 45%  (학습 시작)
Epoch 10:   mAP50: 72%  (배우는 중)
Epoch 50:   mAP50: 92%  (거의 다 배움)
Epoch 100:  mAP50: 98.7% (완성!)

mAP50 = 신뢰도 50% 이상의 정확도
```

---

# **섹션 11: YOLO vs CNN - 최종 비교**

## ⚖️ **"왜 YOLO가 FM에 최적인가?"**

```
┌─────────────────┬────────────┬────────────┐
│ 항목            │   CNN      │   YOLO     │
├─────────────────┼────────────┼────────────┤
│ 처리 속도       │ 200ms      │ 30ms       │
│ 초당 검사량     │ 4개        │ 30개       │
│ 위치 정보       │ 없음       │ 있음 ✅    │
│ 다중 결함 감지  │ 어려움     │ 쉬움 ✅    │
│ 실시간성        │ 낮음       │ 높음 ✅    │
│ 정확도          │ 99%        │ 98.7%      │
│ 메모리 사용     │ 많음       │ 적음 ✅    │
│ 모델 크기       │ 500MB+     │ 50MB ✅    │
└─────────────────┴────────────┴────────────┘

결론: FM의 고속 검사에는 YOLO가 필수! 🚀
```

---

# **섹션 12: FM 퓨즈 검사 라인의 실제 흐름**

## 🏭 **"3초 안에 벌어지는 일"**

```
시간: 0.0초
┌─────────────────────────────────┐
│ 퓨즈 #1 입력                    │
│ 카메라 1 (정면) 촬영 시작       │
└─────────────────────────────────┘

시간: 0.033초 (Frame 1)
├─ 카메라 1: 이미지 캡처
├─ YOLO 처리: 30ms
└─ 결과: "정상" (99.2%) ✅

시간: 0.066초 (Frame 2)
├─ 카메라 2 (옆면) 촬영
├─ YOLO 처리: 30ms
└─ 결과: "정상" (98.5%) ✅

시간: 0.099초 (Frame 3)
├─ 카메라 3 (색상) 촬영
├─ YOLO 처리: 30ms
└─ 결과: "정상" (97.8%) ✅

시간: 0.15초 (최종 판단)
├─ AI 결과: 3/3 정상
├─ 신뢰도: 99.2% (평균)
└─ 최종: ✅ 합격 → 다음 단계 전송

시간: 0.2초
┌─────────────────────────────────┐
│ 퓨즈 #2 입력                    │
│ (퓨즈 #1은 이미 다음 공정으로)  │
└─────────────────────────────────┘

총 처리 시간: 0.2초
초당 처리: 5개 (안정적!)
```

---

# **최종 요약: 2부 정리**

## ✅ **당신이 배운 것**

```
1️⃣ CNN의 한계와 YOLO의 탄생
   - CNN 200ms → YOLO 30ms (6.7배 빠름)
   - "한 번만 본다"는 개념

2️⃣ 그리드와 ROI
   - 이미지를 작은 셀로 나누기
   - 각 셀에서 중요한 부분 찾기

3️⃣ YOLO의 3가지 구조
   - Backbone: 특징 추출
   - Neck: 특징 통합
   - Head: ROI 생성

4️⃣ Bounding Box와 신뢰도
   - "불량이 어디" (위치)
   - "얼마나 확실한지" (신뢰도)

5️⃣ 다중 클래스 분류
   - 5가지 결함을 동시에 감지
   - 한 이미지에 여러 결함도 OK

6️⃣ NMS와 Threshold
   - 겹친 박스 정리
   - AI 확신도 검증

7️⃣ YOLO의 훈련
   - 40,000개 이미지 × 100번
   - 2시간만에 98.7% 달성
```

---

## 🎯 **FM이 YOLO로 달성한 것**

```
✅ 초당 30개 검사 (CNN 4개 → YOLO 30개)
✅ 위치 정보 (어디가 망가졌는지 알 수 있음)
✅ 다중 불량 감지 (여러 문제 동시 찾기)
✅ 99.2% 정확도 (인간 검사 추월)
✅ 처리 시간 6.7배 단축 (초고속 검사)
```

---

## 🚀 **다음 3부에서는?**

**"분류 모델: 결함 5가지 자동 판단의 비결"**

3부에서 배울 내용:
- YOLO 이후의 "분류" 단계
- ResNet, EfficientNet 같은 전문가 모델
- FM의 99.5% 신뢰도 최종 달성 과정
- 실시간 모니터링 대시보드

---

## 📌 **당신이 기억해야 할 3가지**

```
1. YOLO는 초고속 + 위치 정보
   (CNN보다 6.7배 빠르고, ROI까지 준다!)

2. 그리드 방식으로 한 번에 본다
   (전체 이미지를 동시에 처리)

3. 신뢰도 = AI의 확신도
   (95% 이상이면 자동 통과, 이하면 재검사)
```

---

## 💬 **자주 묻는 질문 (FAQ)**

**Q: YOLO는 정말 "한 번만" 보나요?**
A: 맞습니다! 이미지를 한 번에 처리해서 30ms만에 완료해요.

**Q: Bounding Box가 여러 개 나올 수 있나요?**
A: 네! 한 이미지에 여러 결함이 있으면 여러 박스가 나와요.

**Q: 신뢰도가 70%면 뭐가 되나요?**
A: 자동으로 ⚠️ "재검사" 대상이 되고, 최종 검증팀이 확인해요.

**Q: YOLO를 처음부터 훈련하는데 얼마나 걸려요?**
A: FM의 경우 40,000개 이미지로 2시간이면 충분해요 (GPU 기준).

**Q: YOLO의 모델 크기는 정말 50MB?**
A: 네! CNN은 500MB+ 이지만, YOLOv11n은 단 50MB로 아주 가벼워요.

**Q: 여러 카메라에서 동시에 이미지가 들어오면?**
A: 각 카메라별로 따로 YOLO가 실행되고, 3개 결과를 통합해서 최종 판단해요.

---

**2부 완료! 당신은 이제 YOLO의 초고속 비결을 알았습니다!** 🎓

다음 강의에서는 "분류 모델"의 최종 검증과 FM의 99.5% 신뢰도 달성 과정을 배워봅시다!

---

*이 강의 자료는 FM Safety의 "AI 검수 공정" 투명성 프로젝트입니다.*
*초당 30개 검사, 99.5% 신뢰도 - YOLO의 힘을 느껴보세요!* ⚡
